
% Under-/Overbrace
\makeatletter
\newenvironment{btHighlight}[1][]
{\begingroup\def\bt@Highlight@par{#1}\begin{lrbox}{\@tempboxa}}
{\end{lrbox}\bt@HL@box[\bt@Highlight@par]{\@tempboxa}\endgroup}

\newcommand\btHL[1][]{%
\begin{btHighlight}[#1]\bgroup\aftergroup\bt@HL@endenv%
}
\def\bt@HL@endenv{%
\end{btHighlight}%   
\egroup
}
\newcommand{\bt@HL@box}[2][]{%
  $\overset{\text{#1}}{\overbrace{\strut\usebox{#2}}}$%
}
\makeatother

\makeatletter
\newenvironment{bbHighlight}[1][]
{\begingroup\def\bb@Highlight@par{#1}\begin{lrbox}{\@tempboxa}}
{\end{lrbox}\bb@HL@box[\bb@Highlight@par]{\@tempboxa}\endgroup}
\newcommand\bbHL[1][]{%
\begin{bbHighlight}[#1]\bgroup\aftergroup\bb@HL@endenv%
}
\def\bb@HL@endenv{%
\end{bbHighlight}%   
\egroup
}
\newcommand{\bb@HL@box}[2][]{%
  $\underset{\text{#1}}{\underbrace{\strut\usebox{#2}}}$%
}
\makeatother


% Code environment
\newcounter{cntCode}
\newcommand{\lstCode}[1][]{
	\renewcommand*\lstlistingname{Code}
	\lstset{style=code}
	\ifthenelse
		{\isempty{#1}}
		{\lstset{title={},caption={}}}
		{
			\stepcounter{cntCode}
			\lstset{title={\lstlistingname\ \arabic{cntCode}: #1}}
		}
}
\lstdefinestyle{code}{
	basicstyle=\ttfamily,
	numbersep=5pt,
	backgroundcolor=\color{gray},
	showspaces=false,
	tabsize=2,
	breaklines=true,
	prebreak={\textbackslash},
	literate=
	    {Ö}{{\"O}}1
	    {Ä}{{\"A}}1
	    {Ü}{{\"U}}1
	    {ß}{{\ss}}1
	    {ü}{{\"u}}1
	    {ä}{{\"a}}1
	    {ö}{{\"o}}1
	    {~}{{\textasciitilde}}1
}


% Shell environment
\newcounter{cntShell}
\newcommand{\lstShell}[1][]{
	\renewcommand*\lstlistingname{Shell}
	\lstset{style=shell}
	\ifthenelse
		{\isempty{#1}}
		{\lstset{title={},caption={}}}
		{
			\stepcounter{cntShell}
			\lstset{title={\lstlistingname\ \arabic{cntShell}: #1}}
		}
}
\lstdefinestyle{shell}{
	language=bash,
	basicstyle=\ttfamily,
    keywordstyle=\color{blue}\ttfamily,
    stringstyle=\color{red}\ttfamily,
    commentstyle=\color{OliveGreen}\ttfamily,
	numbersep=5pt,
	backgroundcolor=\color{gray},
	showspaces=false,
	tabsize=2,
	breaklines=true,
	prebreak={\textbackslash},
	literate={\$}{{\textcolor{shell_key}{\$}}}1,
	literate={\\\#}{{\textcolor{black}{\#}}}1,
	literate=
	    {Ö}{{\"O}}1
	    {Ä}{{\"A}}1
	    {Ü}{{\"U}}1
	    {ß}{{\ss}}1
	    {ü}{{\"u}}1
	    {ä}{{\"a}}1
	    {ö}{{\"o}}1
	    {~}{{\textasciitilde}}1,
	morekeywords={apropos,cp,cut,df,du,grep,ls,man,mkdir,more,mount,mv,rm,sort,touch,tr,umount,uniq,wc}
}

% Bash environment
\newcounter{cntBash}
\newcommand{\lstBash}[1][]{
	\renewcommand*\lstlistingname{Bash}
	\lstset{style=bash}
	\ifthenelse
		{\isempty{#1}}
		{\lstset{title={},caption={}}}
		{
			\stepcounter{cntBash}
			\lstset{title={\lstlistingname\ \arabic{cntBash}: #1}}
		}
}
\lstdefinestyle{bash}{
	language=bash,
	basicstyle=\ttfamily,
    keywordstyle=\color{blue}\ttfamily,
    stringstyle=\color{red}\ttfamily,
    commentstyle=\color{OliveGreen}\ttfamily,
	numbersep=5pt,
	backgroundcolor=\color{gray},
	showspaces=false,
	tabsize=2,
	breaklines=true,
	prebreak={\textbackslash},
	literate={\\\$}{{\$}}1,
	literate=
	    {Ö}{{\"O}}1
	    {Ä}{{\"A}}1
	    {Ü}{{\"U}}1
	    {ß}{{\ss}}1
	    {ü}{{\"u}}1
	    {ä}{{\"a}}1
	    {ö}{{\"o}}1
	    {~}{{\textasciitilde}}1,
	morekeywords={in,esac}
}

% C environment
\newcounter{cntCcode}
\newcommand{\lstCcode}[1][]{
	\renewcommand*\lstlistingname{C-Code}
	\lstset{style=ccode}
	\ifthenelse
		{\isempty{#1}}
		{\lstset{title={},caption={}}}
		{
			\stepcounter{cntCcode}
			\lstset{title={\lstlistingname\ \arabic{cntCcode}: #1}}
		}
}
\lstdefinestyle{ccode}{
	language=C++,
	basicstyle=\ttfamily,
    keywordstyle=\color{blue}\ttfamily,
    stringstyle=\color{red}\ttfamily,
    commentstyle=\color{OliveGreen}\ttfamily,
	numbersep=5pt,
	backgroundcolor=\color{gray},
	showspaces=false,
	tabsize=2,
	breaklines=true,
	literate=
	    {Ö}{{\"O}}1
	    {Ä}{{\"A}}1
	    {Ü}{{\"U}}1
	    {ß}{{\ss}}1
	    {ü}{{\"u}}1
	    {ä}{{\"a}}1
	    {ö}{{\"o}}1
	    {~}{{\textasciitilde}}1,
	prebreak={\textbackslash}
}

% Haskell environment
\newcounter{cntHaskell}
\newcommand{\lstHaskell}[1][]{
	\renewcommand*\lstlistingname{Haskell}
	\lstset{style=haskell}
	\ifthenelse
		{\isempty{#1}}
		{\lstset{title={},caption={}}}
		{
			\stepcounter{cntHaskell}
			\lstset{title={\lstlistingname\ \arabic{cntHaskell}: #1}}
		}
}
\lstdefinestyle{haskell}{
	language=Haskell,
	basicstyle=\ttfamily,
    keywordstyle=\color{blue}\ttfamily,
    stringstyle=\color{red}\ttfamily,
    commentstyle=\color{OliveGreen}\ttfamily,
	numbersep=5pt,
	backgroundcolor=\color{gray},
	showspaces=false,
	tabsize=2,
	breaklines=true,
	prebreak={\textbackslash},
	literate={\\\$}{{\textcolor{black}{\$}}}1,
	literate=
	    {Ö}{{\"O}}1
	    {Ä}{{\"A}}1
	    {Ü}{{\"U}}1
	    {ß}{{\ss}}1
	    {ü}{{\"u}}1
	    {ä}{{\"a}}1
	    {ö}{{\"o}}1
	    {~}{{\textasciitilde}}1
}

% Lisp environment
\newcounter{cntLisp}
\newcommand{\lstLisp}[1][]{
	\renewcommand*\lstlistingname{Lisp}
	\lstset{style=lisp}
	\ifthenelse
		{\isempty{#1}}
		{\lstset{title={},caption={}}}
		{
			\stepcounter{cntLisp}
			\lstset{title={\lstlistingname\ \arabic{cntLisp}: #1}}
		}
}
\lstdefinestyle{lisp}{
	language=Lisp,
	basicstyle=\ttfamily,
    keywordstyle=\color{blue}\ttfamily,
    stringstyle=\color{red}\ttfamily,
    commentstyle=\color{OliveGreen}\ttfamily,
	numbersep=5pt,
	backgroundcolor=\color{gray},
	showspaces=false,
	tabsize=2,
	breaklines=true,
	prebreak={\textbackslash},
	literate=
	    {Ö}{{\"O}}1
	    {Ä}{{\"A}}1
	    {Ü}{{\"U}}1
	    {ß}{{\ss}}1
	    {ü}{{\"u}}1
	    {ä}{{\"a}}1
	    {ö}{{\"o}}1
	    {~}{{\textasciitilde}}1
}